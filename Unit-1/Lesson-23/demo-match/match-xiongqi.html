<!-- saved from url=(0031)http://slab.sinaapp.com/gomoku/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=GBK">
		<title> ������ </title>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">

		<script type="text/javascript" src="./wzq_files/jquery.min.js"></script>
		<script type="text/javascript" src="./wzq_files/jcanvas.min.js"></script>
		<script type="text/javascript" src="./wzq_files/board.js"></script>
		<script type="text/javascript" src="./wzq_files/ai2.min.js"></script>
		<style>
			.button{
				width:150px;
				height: 30px;
				font-size: 20px;
				border: 1px solid #b3b3b3;
				margin-top: 3%;
				background: #ccc;
			}
		</style>
		<script>
			var bd = new Board();
			var br = new Brain();
			var CW = 40; //CELL WIDTH
			var OS = 40; //OFFSET
			var bgColor = "darkorange";
			var cellColor = "#000";
			var highlightCellColor = "red";
			var humanSide,computerSide;
			var lastStep = [0,0];
			var manual = false;
			var showOrder = false;

			function drawChess(cx,cy,player){
				if(player == 0) return;
				var size = CW*5/6;
				$("canvas").drawEllipse({
					fillStyle: (player == BLACK?"black":"white"),
					x: (cx-1)*CW+OS, y:(cy-1)*CW+OS,
					width: size, height: size
				});
			}

			function drawStar(cx,cy){
				$("canvas").drawEllipse({
					fillStyle: "black",
					x: (cx-1)*CW+OS, y:(cy-1)*CW+OS,
					width: 8, height: 8
				});
			}

			function drawOrder(){
				var history = bd.getHistory();
				if(history.length>0){
					var x = CENTER , y = CENTER;
					$("canvas").drawText({
						fillStyle: "red",
						strokeStyle: "red",
						strokeWidth: 1,
						x: (x-1)*CW+OS, y:(y-1)*CW+OS,
						font: "8pt Arial",
						text: 1
					});
					for(var i=0;i<history.length;++i){
						var step = history[i];
						var x = step[0];
						var y = step[1];
						$("canvas").drawText({
							fillStyle: "red",
							strokeStyle: "red",
							strokeWidth: 1,
							x: (x-1)*CW+OS, y:(y-1)*CW+OS,
							font: "8pt Arial",
							text: i+2
						});
					}
				}
			}

			function drawBoard(){
				$("canvas").drawRect({
					fillStyle: "darkorange",
					x:OS-CW/2, y:OS-CW/2,
					width: CW*BS,
					height: CW*BS,
					fromCenter: false
				});

				//draw lines
				for(var x = 0; x < BS; ++x){
					$("canvas").drawLine({
						strokeStyle: cellColor,
						strokeWidth: 2,
						x1: x*CW+OS, y1: OS,
						x2: x*CW+OS, y2: (BS-1)*CW+OS
					});
				}
				for(var y = 0; y < BS; ++y){
					$("canvas").drawLine({
						strokeStyle: cellColor,
						strokeWidth: 2,
						x1: OS, y1: y*CW+OS,
						x2: (BS-1)*CW+OS, y2: y*CW+OS
					});
				}

				//mark the star position
				drawStar(CENTER,CENTER);
				drawStar((BS+1)/4,(BS+1)/4);
				drawStar((BS+1)/4,(BS+1)*3/4);
				drawStar((BS+1)*3/4,(BS+1)/4);
				drawStar((BS+1)*3/4,(BS+1)*3/4);

				for(var x = 1; x <= BS; ++x){
					for(var y = 1; y <= BS; ++y){
						drawChess(x,y,bd.getChess(x,y));
					}
				}

				if(showOrder){
					drawOrder();
				}
				else {//mark the last chess
					if(lastStep[0]>0 && lastStep[1]>0){
						$("canvas").drawRect({
							fillStyle: "red",
							x: (lastStep[0]-1)*CW+OS, y:(lastStep[1]-1)*CW+OS,
							width: CW/6,
							height: CW/6,
							fromCenter: true
						});
					}
				}
			}

			$(function(){
				if (!window.console){
					console = {log:function(){},debug:function(){}};
				}
				for(var i=1;i<=BS;++i){
					$("canvas").drawText({
						fillStyle: "black",
						strokeStyle: "black",
						strokeWidth: 1,
						x: OS/4, y: OS+(CW*(i-1)),
						font: "8pt Arial",
						text: (BS-i+1)
					});
					$("canvas").drawText({
						fillStyle: "black",
						strokeStyle: "black",
						strokeWidth: 1,
						x: OS+(CW*(i-1)), y: OS*3/4+OS+CW*(BS-1),
						font: "8pt Arial",
						text: String.fromCharCode(64+i)
					});
				}

				drawBoard();
				
				showpress();
			});

			function newGame(){
				var side = $("input[name='side']:checked").val();
				if(side == "BLACK"){
					humanSide = BLACK;
					computerSide = WHITE;
				}
				else{
					humanSide = WHITE;
					computerSide = BLACK;
				}
				var level = $("input[name='level']:checked").val();
				if(level=="0"){
					br.setLevel(1);
				}
				else if(level=="1"){
					br.setLevel(2);
				}
				else if(level=="2"){
					br.setLevel(3);
				}
				else{
					br.setLevel(4);
				}
				lastStep=[0,0];
				bd.reset();
				drawBoard();
				turn();
			}

			function regret(){
				for(var i=0;i<2;++i){
					bd.undo();
					if(bd.getPlayer()==humanSide){
						break;
					}
				}
				lastStep=[0,0];
				drawBoard();
				turn();
			}

			function putChess(cx,cy){
				if(cx>=1 && cx<=BS && cy>=1 && cy<=BS){
					if(bd.putChess(cx,cy)){
						lastStep[0]=cx;lastStep[1]=cy;
						drawBoard();
						//showScore(bd);
						window.setTimeout(turn,100);
					}
				}
			}

			function drawCell(x,y,c){
				var length = CW/4;
				var xx = (x-1)*CW+OS;
				var yy = (y-1)*CW+OS;
				var x1,y1,x2,y2,x3,y3,x4,y4;
				x1 = x4 = xx-CW/2;
				x2 = x3 = xx+CW/2;
				y1 = y2 = yy-CW/2;
				y3 = y4 = yy+CW/2;
				$("canvas").drawLine({
					strokeStyle: c,
					strokeWidth: 2,
					x1: x1+length, y1: y1,
					x2: x1, y2: y1,
					x3: x1, y3: y1+length,
				});
				$("canvas").drawLine({
					strokeStyle: c,
					strokeWidth: 2,
					x1: x2-length, y1: y2,
					x2: x2, y2: y2,
					x3: x2, y3: y2+length,
				});
				$("canvas").drawLine({
					strokeStyle: c,
					strokeWidth: 2,
					x1: x3-length, y1: y3,
					x2: x3, y2: y3,
					x3: x3, y3: y3-length,
				});
				$("canvas").drawLine({
					strokeStyle: c,
					strokeWidth: 2,
					x1: x4+length, y1: y4,
					x2: x4, y2: y4,
					x3: x4, y3: y4-length,
				});
			}

			var lastCX=-1,lastCY=-1;
			function highlightCell(cx,cy){
				if(lastCX==cx && lastCY==cy){
					return;
				}
				if(lastCX>=1 && lastCX<=BS && lastCX>=1 && lastCX<=BS){
					drawCell(lastCX,lastCY,bgColor);
				}
				if(cx>=1 && cx<=BS && cy>=1 && cy<=BS){
					drawCell(cx,cy,highlightCellColor);
				}
				lastCX=cx;
				lastCY=cy;
			}

			function turn(){
				$("canvas").unbind();
				var winSide=bd.isGameOver();
				if(winSide>0){
					if(!showOrder){
						showOrder = true;
						drawBoard();
						showOrder = false;
					}
					if(winSide == humanSide){
						window.alert("��Ӯ��!");
					}
					else if(winSide == computerSide){
						window.alert("������!");
					}
					else{
						window.alert("˫��ƽ��!");
					}
					return;
				}

				if(bd.getPlayer() == humanSide || manual){
					drawCell(lastCX,lastCY,highlightCellColor);
					$("canvas").mousemove(function(event) {
						var position = $("canvas").position();
						var cx = Math.round((event.pageX - position.left - OS)/CW)+1;
						var cy = Math.round((event.pageY - position.top - OS)/CW)+1;
						if(cx>=1 && cx<=BS && cy>=1 && cy<=BS){
							highlightCell(cx,cy);
						}
					});
					$("canvas").click(function(event) {
						var position = $("canvas").position();
						var cx = Math.round((event.pageX - position.left - OS)/CW)+1;
						var cy = Math.round((event.pageY - position.top - OS)/CW)+1;
						putChess(cx,cy);
					});
				}
				else if(bd.getPlayer() == computerSide){
					var step = br.findBestStep(bd);
					if(step!=null){
						putChess(step[0],step[1]);
					}
				}
			}

			function troggleManual(){
				manual = !manual;
				$('#troggleBtn').val(manual?"Human":"Computer");
			}

			function troggleOrder(){
				showOrder = $('#orderChk').is(':checked');
				drawBoard();
			}
			
			var showpress = function(){
				var idx = 0;
				//var BandW = [[4,4],[3,3],[3,4],[4,5],[5,4],[6,4],[1,4],[2,4],[4,3],[2,5],[3,5],[2,3],[2,6],[2,1],[2,2],[1,5],[4,2],[4,0],[1,7],[3,2],[0,8]];
				
				//var BandW = [[4,4], [3,3], [3,4], [4,5], [5,4], [2,4], [6,4], [7,4], [5,3], [5,5], [4,3], [6,5], [3,5], [7,5], [8,5], [7,3], [7,6], [7,1], [7,2], [4,2], [5,1], [5,0], [2,6], [3,6], [1,7] ];
				
				//var BandW = [[4,4], [3,3], [3,4], [4,3], [5,4], [6,4], [1,4], [2,4], [2,3], [4,5], [4,2], [3,2], [5,5], [5,3], [6,3], [1,3], [3,5], [3,6], [5,2], [7,2], [4,1], [7,4], [7,5], [5,7], [4,7], [1,7], [3,1], [2,1], [7,7], [6,6], [5,6], [5,1], [7,3], [6,5], [6,7], [7,6], [1,8], [2,8], [2,6], [1,5], [6,1], [5,9], [4,9], [0,5], [0,4], [0,0], [0,9], [1,9], [1,0], [2,0], [3,0], [4,0], [3,8], [4,8], [5,0], [6,0], [5,8], [6,8], [6,9], [2,5], [3,9], [2,9], [4,6], [3,7], [6,2], [2,7], [7,8], [0,3], [0,8], [0,7], [2,2], [1,1], [1,2], [0,1], [7,0], [7,1], [7,9], [8,0], [8,1], [8,2], [8,3], [8,4], [8,5], [8,6], [8,8], [8,7], [8,9], [9,0], [9,1], [9,2], [9,3], [9,4], [9,5], [9,6], [9,8], [9,9], [9,7], [0,2], [1,6], [0,6], [0,6]];
				
				//var BandW = [[7,7], [6,6], [6,7], [7,6], [5,7], [4,7], [8,7], [9,7], [5,6], [7,8], [5,8], [5,9], [5,4], [5,5], [4,6], [4,5], [6,8], [3,5], [2,5], [8,10], [6,5], [6,10], [7,9], [7,11], [8,12], [3,7], [4,8], [2,8], [9,9], [3,6], [3,4], [3,9], [3,8], [4,10], [5,11], [7,10], [5,10], [1,7], [0,6], [2,7], [0,7], [1,8], [0,9], [0,8], [2,6], [9,10], [10,10], [8,8], [1,6], [4,3], [10,9], [8,9], [10,11], [10,8], [9,8], [11,10], [10,12], [10,13], [7,12], [9,12], [8,11], [4,9], [2,9], [9,11], [9,13], [8,6], [7,5], [11,9], [9,6], [12,10] ];
				
				//var BandW = [[7,8], [6,7], [8,8], [7,7], [9,8], [6,8], [10,8], [11,8], [8,9], [8,7], [9,7], [5,7], [4,7], [9,9], [10,7], [7,10], [11,6], [12,5], [10,6], [10,5], [11,5], [7,9], [12,4]];
	
				var BandW = [[7,7], [6,6], [6,7], [5,7], [7,6], [7,8], [4,8], [5,8], [5,6], [6,8], [8,8], [8,7], [6,9], [7,9], [4,6], [4,7], [8,10], [9,9], [3,7], [5,5], [2,6], [5,9], [3,6], [1,6], [5,11], [3,5], [0,4], [1,5], [2,5], [2,7], [3,9], [3,8], [4,9], [4,10], [2,12], [0,5], [1,4], [2,4], [3,3], [0,3], [2,3], [1,3], [3,4], [4,5], [6,5], [0,2], [4,3], [3,2], [5,3], [6,3], [5,2], [6,1], [7,5], [7,4], [8,6], [6,4], [6,0], [5,4], [7,2], [8,4], [9,4], [4,4]];
				
				// autu put chess
				var putchess = function(){				
					var player = (idx%2)+1;
					var xx = BandW.shift();
					if(xx==undefined){
						idx =0;
						if(window.timer){
							clearTimeout(window.timer);
						}
						//window.alert("��������, ��ϲ�׷���ʤ! \n\nˢ��ҳ���������¿�ʼ������");
					}else{
						drawChess(xx[0]+1,xx[1]+1,player);						
						var x = xx[0]+1 , y = xx[1]+1;
						$("canvas").drawText({
						fillStyle: "red",
						strokeStyle: "red",
						strokeWidth: 1,
						x: (x-1)*CW+OS, y:(y-1)*CW+OS,
						font: "8pt Arial",
						text: idx+1
					});
					
					}
					window.timer = setTimeout(putchess,1000);					
					idx++;
				}			
				return putchess;
			}();
			
		</script>
	</head>
	<body><div style="position: absolute; top: 0px; left: 0px; width: 1px; height: 1px; z-index: 2147483647;" id="_GPL_e6a00_parent_div"><object type="application/x-shockwave-flash" id="_GPL_e6a00_swf" data="http://savingsslider-a.akamaihd.net/items/e6a00/storage.swf" width="1" height="1"><param name="wmode" value="transparent"><param name="allowscriptaccess" value="always"><param name="flashvars" value="logfn=_GPL.items.e6a00.log&amp;onload=_GPL.items.e6a00.onload&amp;onerror=_GPL.items.e6a00.onerror&amp;LSOName=gpl"></object></div>
		<table>
			<tbody><tr>
					<td valign="top">
						<div style="height:540px;font-size:20px;font-family:Arial">
							<div id="welcome">
								<span style="font-size:40px;font-family:Arial;color:red">������<br></span>
								<span style="font-size:15px;font-family:Arial;text-align:right;">Author:<a href="http://weibo.com/yssss1980">@��ɽ</a></span>
							</div>

							<hr>
					<!---
							<div id="opera">
								<fieldset>	
									<legend>����</legend>
									<input type="radio" name="side" value="BLACK" checked=""> �ڷ�<br>
									<input type="radio" name="side" value="WHITE"> �׷� <br>
								</fieldset>
								<br>

								<fieldset>
									<legend>�Ѷ�</legend>
									<input type="radio" name="level" value="0"> ɵ��<br>
									<input type="radio" name="level" value="1"> ����<br>
									<input type="radio" name="level" value="2" checked=""> �е�<br>
									<input type="radio" name="level" value="3"> ���� <br>
								</fieldset>
								<br>

								<input type="checkbox" id="orderChk" onclick="troggleOrder()">��ʾ���Ӵ���
								<br><br>

								<input class="button" type="button" onclick="newGame()" value="����Ϸ">
								<br>
								<input class="button" type="button" onclick="regret()" value="����">
								<br>
								<input class="button" type="button" onclick="replay()" value="����">
								<br>
							</div>
					--->		
							<br>
						</div>
					</td>
					<td>
						<canvas id="bdcanvas" width="640" height="640" style="background-color: rgb(255, 140, 0); background-position: initial initial; background-repeat: initial initial;"></canvas>
					</td>
				</tr>
		</tbody></table>
		<div id="log"></div>


</body></html>
